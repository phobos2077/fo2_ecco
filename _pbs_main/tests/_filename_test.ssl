#line 1 "ECROBBER.SSL"
#line 9 "ECROBBER.SSL"
#line 1 "../headers/define.h"
#line 10 "../headers/define.h"
#line 1 "../headers/global.h"
#line 11 "../headers/define.h"
#line 1 "../headers/itempid.h"
#line 12 "../headers/define.h"
#line 1 "../headers/scripts.h"
#line 13 "../headers/define.h"
#line 1 "../headers/teams.h"
#line 14 "../headers/define.h"
#line 1 "../headers/Condtion.h"
#line 45 "../headers/Condtion.h"
variable ProtoOfItemGiven;
variable ValueOfRollCheck:= 1 ;
#line 15 "../headers/define.h"
#line 16 "../headers/define.h"
#line 1 "../headers/AIPacket.h"
#line 17 "../headers/define.h"
#line 1 "../headers/ExpPoint.h"
#line 18 "../headers/define.h"
#line 1 "../headers/ScenePid.h"
#line 18 "../headers/ScenePid.h"
variable Scenery_Creation;
variable Scenery_Creation_Hex;
variable Scenery_Creation_Count;
variable Temp_Scenery_Creation_Hex;
variable Scenery_Creation_Ptr;
#line 19 "../headers/define.h"
#line 1 "../headers/Maps.h"
#line 20 "../headers/define.h"
#line 1 "../headers/animcomd.h"
#line 21 "../headers/define.h"
#line 1 "../headers/CritrPid.h"
#line 22 "../headers/define.h"
#line 1 "../headers/ArtFid.h"
#line 23 "../headers/define.h"
#line 1 "../headers/Party.h"
#line 13 "../headers/Party.h"
variable How_Many_Party_Members_Are_Injured;
variable How_Many_Party_Members_Armed;
#line 279 "../headers/Party.h"
variable PartyHealingItem;
#line 816 "../headers/Party.h"
procedure checkPartyMembersNearDoor begin
   if ( ( party_member_obj( (16777278) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777278) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777376) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777376) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777377) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777377) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777305) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777305) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777313) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777313) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777323) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777323) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777352) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777352) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777378) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777378) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777368) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777368) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777379) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777379) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777380) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777380) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777295) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777295) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777381) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777381) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777407) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777407) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777411) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777411) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777412) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777412) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777413) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777413) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777481) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777481) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777558) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777558) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777600) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777600) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777718) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777718) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777719) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777719) ) ) <= (5) ) then begin return 1; end end
   if ( ( party_member_obj( (16777720) ) != 0) ) then begin if (tile_distance_objs(self_obj, party_member_obj( (16777720) ) ) <= (5) ) then begin return 1; end end
   return 0;
end
#line 24 "../headers/define.h"
#line 1 "../headers/Reaction.h"
#line 25 "../headers/define.h"
#line 10 "ECROBBER.SSL"
#line 1 "../headers/bhrnddst.h"
#line 14 "../headers/bhrnddst.h"
variable Finding_New_Tile;
#line 11 "ECROBBER.SSL"
#line 14 "ECROBBER.SSL"
#line 1 "../headers/command.h"
#line 20 "../headers/command.h"
#line 1 "../headers/reppoint.h"
#line 12 "../headers/reppoint.h"
variable tmp_gen_rep := 0;
#line 21 "../headers/command.h"
#line 27 "../headers/command.h"
variable global_temp;
#line 156 "../headers/command.h"
variable dest_tile;
variable step_tile;
#line 452 "../headers/command.h"
variable in_dialog;
variable forced_node;
#line 764 "../headers/command.h"
variable restock_amt;
variable restock_obj;
variable restock_trash;
variable removed_qty;
#line 15 "ECROBBER.SSL"
#line 18 "ECROBBER.SSL"
#line 1 "../_pbs_main/quests_bounty.h"
#line 1 "define_lite.h"
#line 2 "../_pbs_main/quests_bounty.h"
#line 1 "command_lite.h"
#line 3 "../_pbs_main/quests_bounty.h"
#line 1 "mod.h"
#line 9 "mod.h"
#line 1 "define_extra.h"
#line 10 "mod.h"
#line 1 "lib.misc.h"
#line 26 "lib.misc.h"
procedure parse_hotkey(variable string) begin
   variable lst;
   variable n;
   lst := string_split(string, "+");
   if (len_array(lst) == 0) then
      return 0;
   n := atoi(lst[0]);
   if (len_array(lst) > 1) then
      n += atoi(lst[1])*0x10000;
   return n;
end


procedure hotkey_pressed(variable n) begin
   if (n < 0x10000) then
      return key_pressed(n);
   else
      return key_pressed(n bwand 0xFFFF) and key_pressed((n bwand 0xFFFF0000) / 0x10000);
end


procedure hotkey_pressed_now(variable n, variable key) begin
   if (n < 0x10000) then
      return key == n;
   else begin
      variable k1 := (n bwand 0xFFFF),
               k2 := ((n bwand 0xFFFF0000) / 0x10000);
      if (k1 == key) then begin
         if (key_pressed(k2)) then return true;
      end else if (k2 == key) then begin
         if (key_pressed(k1)) then return true;
      end
      return false;
   end
end
#line 11 "mod.h"
#line 4 "../_pbs_main/quests_bounty.h"
#line 1 "sfall.h"
#line 5 "../_pbs_main/quests_bounty.h"
#line 1 "lib.strings.h"
#line 18 "lib.strings.h"
procedure string_pos(variable str, variable subst) begin
   variable lst, n;
   lst := string_split(str, subst);
   if (len_array(lst) < 2) then
      return -1;
   return strlen(lst[0]);
end
#line 29 "lib.strings.h"
procedure string_join(variable array, variable join) begin
   variable str, i, len;
   str := "";
   len := len_array(array);
   if (len > 0) then begin
      str := array[0];
      for (i:=1; i<len; i++) begin
         str += join + array[i];
      end
   end
   return str;
end
#line 50 "lib.strings.h"
procedure sprintf2(variable str, variable arg1, variable arg2) begin
   variable split, len, i, j, arg;
   split := string_split(str, "%");
   len := len_array(split);
   str := "";
   if (len > 0) then begin
      str := split[0];
      j := 0;
      for (i := 1; i < len; i++) begin
         if (split[i] == "") then begin
            if (i < len - 1) then begin
               str += "%" + split[i+1];
               i++;
            end
         end else begin
            if (j == 0) then
               arg := arg1;
            else if (j == 1) then
               arg := arg2;
            else
               arg := 0;

            str += sprintf("%" + split[i], arg);
            j++;
         end
      end
   end
   return str;
end
#line 83 "lib.strings.h"
procedure sprintf_array(variable str, variable args) begin
   variable split, len, i, j;
   split := string_split(str, "%");
   len := len_array(split);
   str := "";
   if (len > 0) then begin
      str := split[0];
      j := 0;
      for (i := 1; i < len; i++) begin
         if (split[i] == "") then begin
            if (i < len - 1) then begin
               str += "%" + split[i+1];
               i++;
            end
         end else begin
            str += sprintf("%" + split[i], args[j]);
            j++;
         end
      end
   end
   return str;
end
#line 121 "lib.strings.h"
procedure string_get_tokens(variable str, variable delim) begin
   variable lst, line, token, maxlen, len, count;
   count := 1;
   maxlen := 4;
   token := tokenize(str, 0, delim);


      line := token;
      while (line != str) do begin
         count += 1;
         len := strlen(token);
         if (len > maxlen) then
            maxlen := len;
         token := tokenize(str, line, delim);
         if (token != 0) then
            line += delim + token;
      end


   return count;
end

procedure string_repeat(variable str, variable count) begin
   variable out := "", i := 0;
   while (i < count) do begin
      out += str;
      i++;
   end
   return out;
end
#line 156 "lib.strings.h"
procedure string_split_safe(variable str, variable split) begin
   variable lst;
   str += split;
   lst := string_split(str, split);
   resize_array(lst, len_array(lst) - 1);
   return lst;
end
#line 168 "lib.strings.h"
procedure string_split_ints(variable str, variable split) begin
	variable i := 0;
	variable list;
	list := string_split(str, split);
	while (i < len_array(list)) do begin
		list[i] := atoi(list[i]);
		i++;
	end
	return list;
end
#line 214 "lib.strings.h"
procedure parse_str_list(variable str, variable list) begin
variable token, rest, line, result, n; line := tokenize(str, 0, '%'); result := line; while line != str do begin token := tokenize(str, line, '%'); line += "%" + token; if token == "" then result += "%"; else begin
      n := atoi(token) - 1;
      if (n >= 0 and n < len_array(list)) then result += list[n];
end rest := tokenize(str, line, '%'); if (rest != 0) then begin line += "%" + rest; result += rest; end end return result;
end

procedure parse_str_2(variable str, variable x1, variable x2) begin
variable token, rest, line, result, n; line := tokenize(str, 0, '%'); result := line; while line != str do begin token := tokenize(str, line, '%'); line += "%" + token; if token == "" then result += "%"; else begin
      n := atoi(token);
      if (n == 1) then result += x1;
      else if (n == 2) then result += x2;
end rest := tokenize(str, line, '%'); if (rest != 0) then begin line += "%" + rest; result += rest; end end return result;
end

procedure parse_str_4(variable str, variable x1, variable x2, variable x3, variable x4) begin
variable token, rest, line, result, n; line := tokenize(str, 0, '%'); result := line; while line != str do begin token := tokenize(str, line, '%'); line += "%" + token; if token == "" then result += "%"; else begin
      n := atoi(token);
      if (n == 1) then result += x1;
      else if (n == 2) then result += x2;
      else if (n == 3) then result += x3;
      else if (n == 4) then result += x4;
end rest := tokenize(str, line, '%'); if (rest != 0) then begin line += "%" + rest; result += rest; end end return result;
end
#line 6 "../_pbs_main/quests_bounty.h"
#line 1 "../headers/teams.h"
#line 7 "../_pbs_main/quests_bounty.h"
#line 8 "../_pbs_main/quests_bounty.h"
#line 1 "lib.inven.h"
#line 5 "lib.inven.h"
#line 1 "define_lite.h"
#line 6 "lib.inven.h"
#line 10 "lib.inven.h"
procedure inven_as_array(variable critter) begin
  variable i:=0, list;
  list := temp_array(100, 4);
  while ( inven_cmds(critter, (13) ,i) ) do begin
    if (i>=len_array(list)) then
      resize_array(list, len_array(list) + 100);
    list[i] :=  inven_cmds(critter, (13) ,i) ;
    i++;
  end
  resize_array(list, i);
  return list;
end


procedure add_items_pid(variable who_obj, variable the_pid, variable pid_qty) begin
    variable item;
    item :=  create_object_sid(the_pid,0,0,-1) ;
    add_mult_objs_to_inven(who_obj, item, (pid_qty));
    return item;
end
#line 38 "lib.inven.h"
procedure unwield_armor(variable who_obj) begin
    variable armor;
    if (not(who_obj)) then return;
    if ( (obj_item_subtype(critter_inven_obj(who_obj, (0) )) == (0) ) ) then begin
       armor := critter_inven_obj(who_obj, (0) );
       rm_obj_from_inven(who_obj, armor);
       add_obj_to_inven(who_obj, armor);
    end
end

procedure remove_items_pid(variable who_obj, variable the_pid, variable pid_qty) begin
    variable begin
        item;
        removed_qty;
        tmp;
    end
    if (not(who_obj)) then return;
    removed_qty := obj_is_carrying_obj_pid(who_obj,the_pid);
    if (pid_qty < removed_qty and pid_qty != -1) then begin
      removed_qty := pid_qty;
    end
    if (removed_qty > 0) then begin
      item := obj_carrying_pid_obj(who_obj, the_pid);
      if (obj_type(who_obj) == 1) then begin
         if (critter_inven_obj(who_obj, (0) ) == item) then begin
            call unwield_armor(who_obj);
         end else if ((critter_inven_obj(who_obj,  (2) ) == item) or (critter_inven_obj(who_obj,  (1) ) == item)) then begin
            metarule( 43 , who_obj) ;
         end
      end
      tmp := rm_mult_objs_from_inven(who_obj, item, removed_qty);
      destroy_object(item);
    end
end

procedure remove_item_obj(variable who_obj, variable item) begin
   if (obj_type(who_obj) == 1) then begin
      if (critter_inven_obj(who_obj, (0) ) == item) then begin
         call unwield_armor(who_obj);
      end else if ((critter_inven_obj(who_obj,  (2) ) == item) or (critter_inven_obj(who_obj,  (1) ) == item)) then begin
         metarule( 43 , who_obj) ;
      end
   end
   rm_obj_from_inven(who_obj, item);
   destroy_object(item);
end
#line 92 "lib.inven.h"
procedure set_items_qty_pid(variable invenobj, variable itempid, variable newcount)
begin
	variable begin
		count;
		obj;
	end
	count := obj_is_carrying_obj_pid(invenobj, itempid);
	if (newcount > count) then begin
		obj := create_object_sid(itempid, 0, 0, -1);
		add_mult_objs_to_inven(invenobj, obj, newcount - count);
	end else if (newcount < count) then begin
		call remove_items_pid(invenobj, itempid, count - newcount);
	end
end
#line 125 "lib.inven.h"
procedure reduce_merchant_loot(variable critter, variable moneyPercent, variable probArmor, variable probDrugs, variable probWeapons, variable probAmmo, variable probMisc) begin
   variable inv, item, it, prob, tmp;
   inv := inven_as_array(critter);
   item_caps_adjust(critter, -(item_caps_total(critter) * moneyPercent / 100));

   foreach item in inv begin
      if (obj_pid(item) !=  (41) ) then begin
         it := obj_item_subtype(item);
         if (it ==  (0) ) then
            prob := probArmor;
         else if (it ==  (2) ) then
            prob := probDrugs;
         else if (it ==  (3) ) then
            prob := probWeapons;
         else if (it ==  (4) ) then
            prob := probAmmo;
         else
            prob := probMisc;
         if (random(0, 99) < prob) then begin

            call  remove_items_pid(critter, obj_pid(item), -1) ;
         end
      end
   end
end

procedure item_by_attack_type(variable critter, variable type) begin
   variable slot;
   if (type > 3 and type !=  (6)  and type !=  (7) ) then
      return 0;
   if (type < 2 or type ==  (6) ) then
      slot :=  (2) ;
   else
      slot :=  (1) ;
   return critter_inven_obj(critter, slot);
end
#line 9 "../_pbs_main/quests_bounty.h"
#line 65 "../_pbs_main/quests_bounty.h"
procedure bounty_hook_destroy begin
    variable item;
    variable othr;
    variable boss;
    variable maxh;
    variable crit;
    crit := self_obj;
    item := obj_carrying_pid_obj(crit,  (621) );
    if (item and  ( has_trait( (1) ,crit, (6) ) == (135) ) ) then begin



        boss := crit;
        maxh :=  (get_critter_stat(crit, (7) )) ;
        foreach othr in list_as_array( (0) ) if (othr) then if ( ( has_trait( (1) ,othr, (6) ) == (135) )  and  (get_critter_stat(othr, (7) ))  > maxh) then begin
            maxh :=  (get_critter_stat(crit, (7) )) ;
            boss := othr;
        end

        if ( (crit == (get_sfall_global_int( ("PBSLTDTC") )) and ( (get_sfall_global_int( ("PBSLTDTA") )) == (27) or (get_sfall_global_int( ("PBSLTDTA") )) == (29) or (get_sfall_global_int( ("PBSLTDTA") )) == (30) or (get_sfall_global_int( ("PBSLTDTA") )) == (31) or (get_sfall_global_int( ("PBSLTDTA") )) == (32) or (get_sfall_global_int( ("PBSLTDTA") )) == (33) ) )
            or boss != crit) then
        begin
            call  remove_items_pid(crit, (621) , -1) ;
            debug_msg("REMOVE ARM");
        end

        if ( get_sfall_global_int( ("PQST_ROB") )  > 0) then begin set_sfall_global( ("PQST_ROB") ,  get_sfall_global_int( ("PQST_ROB") )  - 1);
            if ( get_sfall_global_int( ("PQST_ROB") )  == 0) then
               set_global_var( (644) ,  (2) );
        end
        debug_msg("Bounty: "+ get_sfall_global_int( ("PQST_ROB") ) );
    end
end
#line 19 "ECROBBER.SSL"


procedure start;
procedure critter_p_proc;
procedure map_enter_p_proc;
procedure destroy_p_proc;
procedure timed_event_p_proc;

variable starttile;

variable wep_pid;
variable ammo_pid;
variable ammo_qty;
variable val;
variable val1;
variable do_once := 0;




procedure combat_p_proc begin
   if (( (elevation(dude_obj))  == 1) and ((cur_map_index ==  (70) ) or (cur_map_index ==  (71) ) or (cur_map_index ==  (72) ) or (cur_map_index ==  (73) ) or (cur_map_index ==  (80) ))) then begin
      if (do_once == 0) then begin

            do_once := 1;
            if (wep_pid !=  (21)  and
                wep_pid !=  (293)  and
                wep_pid !=  (235)  and
                wep_pid !=  (407) ) then begin
               metarule( 43 , self_obj) ;
            end

      end
   end
end


procedure timed_event_p_proc begin
   if (fixed_param ==  1 ) then begin
      if ( obj_carrying_pid_obj(self_obj, wep_pid) ) then begin
         wield_obj_critter(self_obj, obj_carrying_pid_obj(self_obj, wep_pid) ) ;
      end
   end
end

procedure map_enter_p_proc begin
   critter_add_trait(self_obj, (1) , (6) , (135) );
   critter_add_trait(self_obj, (1) , (5) , (22) );

   starttile :=  (tile_num(self_obj)) ;

   if ((elevation(self_obj) != 0) and (not( metarule( 22 , 0) ))) then begin
      item_caps_adjust(self_obj, Random(5, 15) *  (get_critter_stat(dude_obj, (6) )) );
      add_mult_objs_to_inven(self_obj,  create_object_sid( (40) , (tile_num(self_obj)) ,0,-1) , 1);

      val := Random(1, 5);

      if ( (get_pc_stat( (1) ))  < 6) then begin
         if (val == 1) then begin
            wep_pid :=  (8) ;
            ammo_pid :=  (29) ;
            ammo_qty := 2;
         end else if (val == 2) then begin
            wep_pid :=  (9) ;
            ammo_pid :=  (29) ;
            ammo_qty := 2;
         end else if (val == 3) then begin
            wep_pid :=  (7) ;
         end else if (val == 4) then begin
            wep_pid :=  (236) ;
         end else if (val == 5) then begin
            wep_pid :=  (21) ;
         end
      end else if ( (get_pc_stat( (1) ))  < 11) then begin
         if (val == 1) then begin
            wep_pid :=  (9) ;
            ammo_pid :=  (30) ;
            ammo_qty := Random(1,2);
         end else if (val == 2) then begin
            val1 := Random(1, 4);
            if (val1 == 1) then begin
               wep_pid :=  (18) ;
               ammo_pid :=  (31) ;
               ammo_qty := Random(1, 2);
            end else if (val1 == 2) then begin
               wep_pid :=  (94) ;
               ammo_pid :=  (95) ;
               ammo_qty := Random(1, 2);
            end else if (val1 == 3) then begin
               wep_pid :=  (287) ;
               ammo_pid :=  (34) ;
               ammo_qty := Random(1, 2);
            end else if (val1 == 4) then begin
               wep_pid :=  (313) ;
               ammo_pid :=  (111) ;
               ammo_qty := Random(1, 2);
            end
         end else if (val == 3) then begin
            wep_pid :=  (236) ;
         end else if (val == 4) then begin
            wep_pid :=  (6) ;
         end else if (val == 5) then begin
            wep_pid :=  (293) ;
         end
      end else if ( (get_pc_stat( (1) ))  < 15) then begin
         if (val == 1) then begin
            wep_pid :=  (241) ;
            ammo_pid :=  (34) ;
            ammo_qty := Random(1, 2);
         end else if (val == 2) then begin
            val1 := Random(1, 4);
            if (val1 == 1) then begin
               wep_pid :=  (241) ;
               ammo_pid :=  (34) ;
               ammo_qty := Random(1, 2);
            end else if (val1 == 2) then begin
               wep_pid :=  (12) ;
               ammo_pid :=  (36) ;
               ammo_qty := Random(1, 2);
            end else if (val1 == 3) then begin
               wep_pid :=  (385) ;
               ammo_pid :=  (95) ;
               ammo_qty := Random(1, 2);
            end else if (val1 == 4) then begin
               wep_pid :=  (296) ;

               ammo_pid :=  (29) ;
               ammo_qty := Random(1, 2);
            end
         end else if (val == 3) then begin
            wep_pid :=  (116) ;
            ammo_pid :=  (38) ;
            ammo_qty := Random(1, 2);
         end else if (val == 4) then begin
            wep_pid :=  (399) ;
            ammo_pid :=  (38) ;
            ammo_qty := Random(1,2);
         end else if (val == 5) then begin
            wep_pid :=  (235) ;
            ammo_pid :=  (38) ;
            ammo_qty := Random(1, 2);
         end
      end else begin
         if (val == 1) then begin
            wep_pid :=  (233) ;
            ammo_pid :=  (39) ;
            ammo_qty := Random(1, 2);
         end else if (val == 2) then begin
            val1 := Random(1, 4);
            if (val1 == 1) then begin
               wep_pid :=  (332) ;
               ammo_pid :=  (357) ;
               ammo_qty := Random(1, 2);
            end else if (val1 == 2) then begin
               wep_pid :=  (268) ;
               ammo_pid :=  (95) ;
               ammo_qty := Random(1, 2);
            end else if (val1 == 3) then begin
               wep_pid :=  (392) ;
               ammo_pid :=  (358) ;
               ammo_qty := Random(1, 2);
            end else if (val1 == 4) then begin
               wep_pid :=  (351) ;
               ammo_pid :=  (363) ;
               ammo_qty := Random(1, 2);
            end
         end else if (val == 3) then begin
            wep_pid :=  (391) ;
            ammo_pid :=  (359) ;
            ammo_qty := Random(0, 2);
         end else if (val == 4) then begin
            wep_pid :=  (397) ;
            ammo_pid :=  (39) ;
            ammo_qty := Random(1,2);
         end else if (val == 5) then begin
            wep_pid :=  (407) ;
            ammo_pid :=  (38) ;
            ammo_qty := Random(1, 2);
         end
      end
   end

   if (obj_is_carrying_obj_pid(self_obj,wep_pid) < 1) then begin restock_obj := create_object_sid(wep_pid,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (1 - obj_is_carrying_obj_pid(self_obj,wep_pid))); end else if (obj_is_carrying_obj_pid(self_obj,wep_pid) > 1) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,wep_pid); if (((obj_is_carrying_obj_pid(self_obj,wep_pid) - 1)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj,wep_pid) - 1); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, wep_pid); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, wep_pid); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end if (false) then begin if (obj_is_carrying_obj_pid(self_obj, wep_pid)) then begin wield_obj_critter(self_obj, obj_carrying_pid_obj(self_obj, wep_pid)); end else begin debug_msg("NOT ARMING THE WEAPON!!!"); end end if (ammo_pid != 0) then begin if (obj_is_carrying_obj_pid(self_obj,ammo_pid) < ammo_qty) then begin restock_obj := create_object_sid(ammo_pid,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj,ammo_pid))); end else if (obj_is_carrying_obj_pid(self_obj,ammo_pid) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,ammo_pid); if (((obj_is_carrying_obj_pid(self_obj,ammo_pid) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj,ammo_pid) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, ammo_pid); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, ammo_pid); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else begin if ((wep_pid == (8) ) or (wep_pid == (300) ) or (wep_pid == (9) )) then begin if (obj_is_carrying_obj_pid(self_obj, (29) ) < ammo_qty) then begin restock_obj := create_object_sid((29) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (29) ))); end else if (obj_is_carrying_obj_pid(self_obj, (29) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(29) ); if (((obj_is_carrying_obj_pid(self_obj, (29) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (29) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (29) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (29) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if ((wep_pid == (10) ) or (wep_pid == (350) ) or (wep_pid == (355) ) or (wep_pid == (143) ) or (wep_pid == (241) ) or (wep_pid == (287) )) then begin if (obj_is_carrying_obj_pid(self_obj, (34) ) < ammo_qty) then begin restock_obj := create_object_sid((34) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (34) ))); end else if (obj_is_carrying_obj_pid(self_obj, (34) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(34) ); if (((obj_is_carrying_obj_pid(self_obj, (34) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (34) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (34) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (34) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if ((wep_pid == (11) ) or (wep_pid == (400) )) then begin if (obj_is_carrying_obj_pid(self_obj, (32) ) < ammo_qty) then begin restock_obj := create_object_sid((32) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (32) ))); end else if (obj_is_carrying_obj_pid(self_obj, (32) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(32) ); if (((obj_is_carrying_obj_pid(self_obj, (32) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (32) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (32) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (32) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if ((wep_pid == (12) ) or (wep_pid == (353) ) or (wep_pid == (389) ) or (wep_pid == (405) ) or (wep_pid == (23) )) then begin if (obj_is_carrying_obj_pid(self_obj, (35) ) < ammo_qty) then begin restock_obj := create_object_sid((35) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (35) ))); end else if (obj_is_carrying_obj_pid(self_obj, (35) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(35) ); if (((obj_is_carrying_obj_pid(self_obj, (35) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (35) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (35) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (35) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if (wep_pid == (13) ) then begin if (obj_is_carrying_obj_pid(self_obj, (14) ) < ammo_qty) then begin restock_obj := create_object_sid((14) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (14) ))); end else if (obj_is_carrying_obj_pid(self_obj, (14) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(14) ); if (((obj_is_carrying_obj_pid(self_obj, (14) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (14) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (14) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (14) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if ((wep_pid == (15) ) or (wep_pid == (397) ) or (wep_pid == (28) ) or (wep_pid == (118) ) or (wep_pid == (401) ) or (wep_pid == (233) )) then begin if (obj_is_carrying_obj_pid(self_obj, (39) ) < ammo_qty) then begin restock_obj := create_object_sid((39) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (39) ))); end else if (obj_is_carrying_obj_pid(self_obj, (39) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(39) ); if (((obj_is_carrying_obj_pid(self_obj, (39) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (39) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (39) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (39) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if ((wep_pid == (16) ) or (wep_pid == (235) ) or (wep_pid == (407) ) or (wep_pid == (116) ) or (wep_pid == (160) ) or (wep_pid == (399) ) or (wep_pid == (24) ) or (wep_pid == (406) ) or (wep_pid == (393) ) or (wep_pid == (396) ) or (wep_pid == (120) ) or (wep_pid == (402) )) then begin if (obj_is_carrying_obj_pid(self_obj, (38) ) < ammo_qty) then begin restock_obj := create_object_sid((38) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (38) ))); end else if (obj_is_carrying_obj_pid(self_obj, (38) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(38) ); if (((obj_is_carrying_obj_pid(self_obj, (38) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (38) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (38) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (38) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if ((wep_pid == (18) ) or (wep_pid == (398) ) or (wep_pid == (404) ) or (wep_pid == (313) )) then begin if (obj_is_carrying_obj_pid(self_obj, (31) ) < ammo_qty) then begin restock_obj := create_object_sid((31) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (31) ))); end else if (obj_is_carrying_obj_pid(self_obj, (31) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(31) ); if (((obj_is_carrying_obj_pid(self_obj, (31) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (31) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (31) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (31) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if (wep_pid == (22) ) then begin if (obj_is_carrying_obj_pid(self_obj, (33) ) < ammo_qty) then begin restock_obj := create_object_sid((33) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (33) ))); end else if (obj_is_carrying_obj_pid(self_obj, (33) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(33) ); if (((obj_is_carrying_obj_pid(self_obj, (33) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (33) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (33) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (33) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if ((wep_pid == (94) ) or (wep_pid == (354) ) or (wep_pid == (385) ) or (wep_pid == (242) ) or (wep_pid == (268) )) then begin if (obj_is_carrying_obj_pid(self_obj, (95) ) < ammo_qty) then begin restock_obj := create_object_sid((95) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (95) ))); end else if (obj_is_carrying_obj_pid(self_obj, (95) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(95) ); if (((obj_is_carrying_obj_pid(self_obj, (95) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (95) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (95) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (95) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if (wep_pid == (122) ) then begin if (obj_is_carrying_obj_pid(self_obj, (121) ) < ammo_qty) then begin restock_obj := create_object_sid((121) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (121) ))); end else if (obj_is_carrying_obj_pid(self_obj, (121) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(121) ); if (((obj_is_carrying_obj_pid(self_obj, (121) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (121) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (121) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (121) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if (wep_pid == (296) ) then begin if (obj_is_carrying_obj_pid(self_obj, (360) ) < ammo_qty) then begin restock_obj := create_object_sid((360) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (360) ))); end else if (obj_is_carrying_obj_pid(self_obj, (360) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(360) ); if (((obj_is_carrying_obj_pid(self_obj, (360) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (360) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (360) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (360) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if (wep_pid == (270) ) then begin if (obj_is_carrying_obj_pid(self_obj, (274) ) < ammo_qty) then begin restock_obj := create_object_sid((274) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (274) ))); end else if (obj_is_carrying_obj_pid(self_obj, (274) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(274) ); if (((obj_is_carrying_obj_pid(self_obj, (274) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (274) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (274) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (274) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if (wep_pid == (299) ) then begin if (obj_is_carrying_obj_pid(self_obj, (19) ) < ammo_qty) then begin restock_obj := create_object_sid((19) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (19) ))); end else if (obj_is_carrying_obj_pid(self_obj, (19) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(19) ); if (((obj_is_carrying_obj_pid(self_obj, (19) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (19) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (19) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (19) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if ((wep_pid == (161) ) or (wep_pid == (162) ) or (wep_pid == (261) )) then begin if (obj_is_carrying_obj_pid(self_obj, (163) ) < ammo_qty) then begin restock_obj := create_object_sid((163) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (163) ))); end else if (obj_is_carrying_obj_pid(self_obj, (163) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(163) ); if (((obj_is_carrying_obj_pid(self_obj, (163) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (163) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (163) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (163) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if ((wep_pid == (283) ) or (wep_pid == (332) )) then begin if (obj_is_carrying_obj_pid(self_obj, (357) ) < ammo_qty) then begin restock_obj := create_object_sid((357) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (357) ))); end else if (obj_is_carrying_obj_pid(self_obj, (357) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(357) ); if (((obj_is_carrying_obj_pid(self_obj, (357) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (357) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (357) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (357) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if ((wep_pid == (351) ) or (wep_pid == (403) ) or (wep_pid == (387) )) then begin if (obj_is_carrying_obj_pid(self_obj, (363) ) < ammo_qty) then begin restock_obj := create_object_sid((363) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (363) ))); end else if (obj_is_carrying_obj_pid(self_obj, (363) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(363) ); if (((obj_is_carrying_obj_pid(self_obj, (363) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (363) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (363) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (363) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if ((wep_pid == (392) ) or (wep_pid == (394) )) then begin if (obj_is_carrying_obj_pid(self_obj, (358) ) < ammo_qty) then begin restock_obj := create_object_sid((358) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (358) ))); end else if (obj_is_carrying_obj_pid(self_obj, (358) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(358) ); if (((obj_is_carrying_obj_pid(self_obj, (358) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (358) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (358) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (358) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if ((wep_pid == (352) ) or (wep_pid == (391) ) or (wep_pid == (395) )) then begin if (obj_is_carrying_obj_pid(self_obj, (359) ) < ammo_qty) then begin restock_obj := create_object_sid((359) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (359) ))); end else if (obj_is_carrying_obj_pid(self_obj, (359) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(359) ); if (((obj_is_carrying_obj_pid(self_obj, (359) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (359) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (359) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (359) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end else if (wep_pid == (388) ) then begin if (obj_is_carrying_obj_pid(self_obj, (361) ) < ammo_qty) then begin restock_obj := create_object_sid((361) ,0,0,-1) ; add_mult_objs_to_inven(self_obj, restock_obj, (ammo_qty - obj_is_carrying_obj_pid(self_obj, (361) ))); end else if (obj_is_carrying_obj_pid(self_obj, (361) ) > ammo_qty) then begin removed_qty := obj_is_carrying_obj_pid(self_obj,(361) ); if (((obj_is_carrying_obj_pid(self_obj, (361) ) - ammo_qty)) < removed_qty) then begin removed_qty := (obj_is_carrying_obj_pid(self_obj, (361) ) - ammo_qty); end if (removed_qty > 0) then begin restock_obj := obj_carrying_pid_obj(self_obj, (361) ); if (obj_type(self_obj) == 1) then begin restock_obj := obj_carrying_pid_obj(self_obj, (361) ); if (critter_inven_obj(self_obj, (0) ) == restock_obj) then begin if ( (obj_item_subtype(critter_inven_obj(self_obj, (0) )) == (0) ) ) then begin restock_obj := critter_inven_obj(self_obj, (0) ); debug_msg("armour pid == "+obj_pid(restock_obj)); rm_obj_from_inven(self_obj, restock_obj); add_obj_to_inven(self_obj, restock_obj); end end else if ((critter_inven_obj(self_obj, (2) ) == restock_obj) or (critter_inven_obj(self_obj, (1) ) == restock_obj)) then begin metarule( 43 , self_obj) ; end end restock_amt := rm_mult_objs_from_inven(self_obj, restock_obj, removed_qty); destroy_object(restock_obj); end restock_obj := 0; restock_amt := 0; end else begin restock_obj := 0; end end end



   reg_anim_func( 2 , self_obj) ;
   reg_anim_func( 1 , 1 ) ;
   anim(self_obj, (1000) , Random(0, 5)) ;
   reg_anim_func( 3 , 0) ;
end

procedure start begin
end

procedure critter_p_proc begin
   variable val;

   if (obj_can_see_obj(self_obj, dude_obj)) then begin
      attack_complex(dude_obj,0,1,0,0,30000,0,0) ;
   end

   if (not anim_busy(self_obj)) then begin
      val := Random(1, 10);
      if (val == 10) then begin
         reg_anim_func( 2 , self_obj) ;
         reg_anim_func( 1 , 1 ) ;
         animate_move_obj_to_tile(self_obj, tile_num_in_direction(starttile, Random(0, 5), Random(3, 10)), (0) ) ;
         reg_anim_func( 3 , 0) ;
      end else if (val == 9) then begin
         reg_anim_func( 2 , self_obj) ;
         reg_anim_func( 1 , 1 ) ;
         anim(self_obj, (1000) , Random(0, 5)) ;
         reg_anim_func( 3 , 0) ;
      end
   end
end

procedure destroy_p_proc begin
   call bounty_hook_destroy;

   if (source_obj == dude_obj) then begin set_global_var( (4) , (global_var( (4) ) + 1)); if ( metarule( 51 , self_obj) == 2 ) then if (source_obj == dude_obj) then begin set_global_var( (2) ,0) ; set_global_var( (1) , (global_var( (1) ) +1)); set_global_var( (0) , (global_var( (0) ) + (-15) )); debug_msg("Player gains "+ (-15) +" Karma Points."); set_global_var( (37) ,0); set_global_var( (38) ,0); set_global_var( (39) ,0); set_global_var( (40) ,0); set_global_var( (41) ,0); set_global_var( (42) ,0); set_global_var( (43) ,0); set_global_var( (44) ,0); set_global_var( (45) ,0) ; tmp_gen_rep := global_var( (0) ) ; if (has_trait( (0) ,dude_obj, (95) )) then tmp_gen_rep := global_var( (0) ) * 2; if (tmp_gen_rep >= (1000) ) then set_global_var( (37) ,1); else if (tmp_gen_rep >= (750) ) then set_global_var( (38) ,1); else if (tmp_gen_rep >= (500) ) then set_global_var( (39) ,1); else if (tmp_gen_rep >= (250) ) then set_global_var( (40) ,1); else if (tmp_gen_rep > (-250) ) then set_global_var( (41) ,1); else if (tmp_gen_rep > (-500) ) then set_global_var( (42) ,1); else if (tmp_gen_rep > (-750) ) then set_global_var( (43) ,1); else if (tmp_gen_rep > (-1000) ) then set_global_var( (44) ,1); else set_global_var( (45) ,1) ; end if ( ((global_var( (4) ) + global_var( (5) ) >= 25) and ((global_var( (5) ) > (2 * global_var( (4) ))) or (global_var( (3) ) == 1))) ) then begin set_global_var( (3) ,1) ; set_global_var( (2) ,0) ; end if ( (((global_var( (4) ) + global_var( (5) )) >= 25) and ((global_var( (4) ) > (3 * global_var( (5) ))) or (global_var( (2) ) == 1)) and (global_var( (1) ) == 0)) ) then begin set_global_var( (2) ,1) ; set_global_var( (3) ,0) ; end set_global_var( (0) , (global_var( (0) ) + (5) )); debug_msg("Player gains "+ (5) +" Karma Points."); set_global_var( (37) ,0); set_global_var( (38) ,0); set_global_var( (39) ,0); set_global_var( (40) ,0); set_global_var( (41) ,0); set_global_var( (42) ,0); set_global_var( (43) ,0); set_global_var( (44) ,0); set_global_var( (45) ,0) ; tmp_gen_rep := global_var( (0) ) ; if (has_trait( (0) ,dude_obj, (95) )) then tmp_gen_rep := global_var( (0) ) * 2; if (tmp_gen_rep >= (1000) ) then set_global_var( (37) ,1); else if (tmp_gen_rep >= (750) ) then set_global_var( (38) ,1); else if (tmp_gen_rep >= (500) ) then set_global_var( (39) ,1); else if (tmp_gen_rep >= (250) ) then set_global_var( (40) ,1); else if (tmp_gen_rep > (-250) ) then set_global_var( (41) ,1); else if (tmp_gen_rep > (-500) ) then set_global_var( (42) ,1); else if (tmp_gen_rep > (-750) ) then set_global_var( (43) ,1); else if (tmp_gen_rep > (-1000) ) then set_global_var( (44) ,1); else set_global_var( (45) ,1) ; end

   if (cur_map_index ==  (94) ) then begin
       set_map_var((1) ,map_var((1) )-1) ;
   end


end
